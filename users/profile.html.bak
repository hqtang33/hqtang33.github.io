<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Stamina &mdash; Free Website Template, Free HTML5 Template by freehtml5.co</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Free HTML5 Website Template by freehtml5.co" />
  <meta name="keywords" content="free website templates, free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive" />
  <meta name="author" content="freehtml5.co" />
  <style type="text/css">
    .title-field {
      font-weight: 500;
      text-decoration: underline;
    }

    .data-field {
      font-weight: 350;
      padding-bottom: 13px;
    }

    .profile-picture {
      max-width: 300px;
      max-height: 300px;
      display: block;
      margin: auto;
      margin-top: 5%;
      margin-bottom: 7%;
    }

    #btn-responsive {
      width: 100%;
      text-align: center;
      word-wrap: break-word;
      background: #F85A16;
      color: #fff;
      border: 2px solid #F85A16;
      border-radius: 5px;
    }

    .profile-box {
      border: 1px solid lightgrey;
      width: 100%;
      padding: 30px;
      background: rgba(0, 0, 0, 0.05);
      -webkit-border-radius: 5px;
      -moz-border-radius: 5px;
      -ms-border-radius: 5px;
      border-radius: 5px;
      margin-bottom: 40px;
      position: relative;
      min-height: 700px;
    }

    .profile-box2 {
      min-height: 20px;
      padding: 19px;
      margin-bottom: 20px;
      background-color: #f5f5f5;
      border: 1px solid #e3e3e3;
      border-radius: 4px;

      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .05);
      box-shadow: inset 0 1px 1px rgba(0, 0, 0, .05);
    }

    .info {
      margin: auto;
      width: 90%;
      padding: 20px 10px;
      line-height: 0.1;
    }
  </style>
  <!--
	//////////////////////////////////////////////////////

	FREE HTML5 TEMPLATE
	DESIGNED & DEVELOPED by FreeHTML5.co

	Website: 		http://freehtml5.co/
	Email: 			info@freehtml5.co
	Twitter: 		http://twitter.com/fh5co
	Facebook: 		https://www.facebook.com/fh5co

	//////////////////////////////////////////////////////
	 -->

  <!-- Facebook and Twitter integration -->
  <meta property="og:title" content="" />
  <meta property="og:image" content="" />
  <meta property="og:url" content="" />
  <meta property="og:site_name" content="" />
  <meta property="og:description" content="" />
  <meta name="twitter:title" content="" />
  <meta name="twitter:image" content="" />
  <meta name="twitter:url" content="" />
  <meta name="twitter:card" content="" />

  <link href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,500,700,800" rel="stylesheet">

  <!-- Animate.css -->
  <link rel="stylesheet" href="/css/animate.css">
  <!-- Font Awesome -->
  <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <!-- Icomoon Icon Fonts-->
  <link rel="stylesheet" href="/css/icomoon.css">
  <!-- Bootstrap  -->
  <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">

  <!-- Magnific Popup -->
  <link rel="stylesheet" href="/css/magnific-popup.css">

  <!-- Owl Carousel  -->
  <link rel="stylesheet" href="/css/owl.carousel.min.css">
  <link rel="stylesheet" href="/css/owl.theme.default.min.css">

  <!-- Theme style  -->
  <link rel="stylesheet" href="/css/style.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/custom.css">

  <!-- Modernizr JS -->
  <script src="/js/modernizr-2.6.2.min.js"></script>
  <!-- FOR IE9 below -->
  <!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->
  <!-- Admin Page CSS -->
  <link rel="stylesheet" href="../css/admin.css">

</head>

<body>

  <div class="fh5co-loader"></div>

  <div id="page">
    <nav id="header" class="fh5co-nav" role="navigation"></nav>

    <nav class="setting-nav">
      <div class="container">
        <div class="row">
          <div class="col-xs-12 text-center setting-title">
            <p>Users</p>
          </div>
        </div>
      </div>
    </nav>
    <div class="setting-content profile-content">
      <div class="container">
        <div class="row">
          <div class="col-lg-5 col-md-4 col-xs-12">
            <div class="profile-box">
              <h1 class="text-center">Personal Info</h1>
              <div class="profile-picture">
                <img alt="profile_picture" id="profile-picture" class="img-responsive img-circle" src="">
              </div>
              <h2 class="text-center" id="profile-name"></h2>
              <div class="info">
                <p class="title-field">Email:</p>
                <p id="profile-email" class="data-field"></p>
                <p class="title-field">NRIC:</p>
                <p id="profile-nric" class="data-field"></p>
                <p class="title-field">Address:</p>
                <p id="profile-address" class="data-field"></p>
              </div>
            </div>
          </div>
          <div class="col-lg-5 col-md-4 col-xs-12">
            <div class="profile-box">
              <h1 class="text-center">Membership</h1>
              <div class="info">
                <p class="title-field">Membership ID:</p>
                <p id="membership-id" class="data-field"></p>
                <p class="title-field">Membership Name:</p>
                <p id="membership-name" class="data-field"></p>
                <p class="title-field">Membership Type:</p>
                <p id="membership-type" class="data-field"></p>
                <p class="title-field">Membership Description:</p>
                <p id="membership-desc" class="data-field"></p>
                <p class="title-field">Validity:</p>
                <p id="membership-valid" class="data-field"></p>
              </div>

            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-xs-12">
            <div class="profile-box">
              <button href="#insert-picture-popup" type="button" id="btn-responsive" class="open-popup-link">Change Profile Picture</button>
            </div>
          </div>


        </div>
      </div>

    </div>

    <div id="footer"></div>

    <!--- Popup content -->
    <div id="insert-picture-popup" class="white-popup mfp-hide">
      <p class="title-field">Upload your profile picture</p>
      <p class="data-field">Current profile picture</p>
      <div class="profile-picture"><img class="img-circle img-responsive" id="display-profile-picture"></div>
      <input type="file" id="js-profile-picture">
      <br>
      <div id="upload-success" class="alert alert-success" hidden><strong>Upload success!</strong> Profile picture updated.</div>
      <button type="button" id="btn-upload" class="btn btn-primary">Upload</button>

    </div>

  </div>

  <div class="gototop js-top">
    <a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
  </div>

  <!-- jQuery -->
  <script src="/js/jquery.min.js"></script>
  <!-- jQuery Easing -->
  <script src="/js/jquery.easing.1.3.js"></script>
  <!-- Bootstrap -->
  <script src="/js/bootstrap.min.js"></script>
  <!-- Waypoints -->
  <script src="/js/jquery.waypoints.min.js"></script>
  <!-- Stellar Parallax -->
  <script src="/js/jquery.stellar.min.js"></script>
  <!-- Carousel -->
  <script src="/js/owl.carousel.min.js"></script>
  <!-- countTo -->
  <script src="/js/jquery.countTo.js"></script>
  <!-- Magnific Popup -->
  <script src="/js/jquery.magnific-popup.min.js"></script>
  <script src="/js/magnific-popup-options.js"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
  <!-- Main -->
  <script src="../js/main.js"></script>
  <!-- Custom -->
  <script src="../js/custom.js"></script>
  <script type="text/javascript">
    $(function() {
      $("#header").load("/header.html");
      $("#footer").load("/footer.html");

      $('.open-popup-link').magnificPopup({
        type: 'inline',
        midClick: true, // Allow opening popup on middle mouse click. Always set it to true if you don't provide alternative source in href.
        callbacks: {
          close: function() {
            // Will fire when popup is closed
            $("#upload-success").hide();
          }
        }
      });



      firebase.auth().onAuthStateChanged(user => {
        if (user) {
          var userID = user.uid;
          var membershipPlan = new Object();
          var accInfoRef = firebase.database().ref('/account_Info/' + userID);
          var memPlanRef = firebase.database().ref('/membership_Plan/' + userID + '/member_type/');
          accInfoRef.once('value', function(data) {
            var userProfile = data.val();
            $('#profile-picture').attr('src', userProfile.profilePic);
            $('#display-profile-picture').attr('src', userProfile.profilePic);
            $('#profile-name').text(userProfile.fname + ' ' + userProfile.lname);
            $('#profile-email').text(userProfile.email);
            $('#profile-nric').text(userProfile.nric);
            $('#profile-address').text(userProfile.address);
          });

          memPlanRef.once('value', function(data) {
            var planID = data.val();
            console.log(planID == null);
            var planInfoRef = firebase.database().ref('/membership_Info/' + planID);
            planInfoRef.once('value', function(data) {
              var membershipInfo = data.val();
              $("#membership-id").text(membershipInfo.membershipId);
              $("#membership-name").text(membershipInfo.membershipName);
              $("#membership-type").text(membershipInfo.membershipType);
              $("#membership-desc").text(membershipInfo.membershipDesc);
              if (membershipInfo.membershipType == "prepaid") {
                $("#membership-valid").text(membershipInfo.membershipVisits + ' times');
              } else {
                $("#membership-valid").text(membershipInfo.membershipMonth + ' Months');
              }
            });

          });
        }
      });

      $("#btn-upload").on("click", function(e) {
        e.preventDefault();
        var file = $("#js-profile-picture")[0].files[0];
        var userID = firebase.auth().currentUser.uid;
        var database = firebase.database().ref('/account_Info/' + userID);
        firebase.storage().ref('profile_picture/' + userID + '_profilePic.jpg').put(file).then(function(snapshot) {
          var url = snapshot.downloadURL;
          database.update({
            profilePic: url
          });
          $("#display-profile-picture").attr("src", url);
          $("#profile-picture").attr("src", url);
          $("#upload-success").show();

        });
      });

    });
  </script>



</body>

</html>
